# 实现行为风险记账

更新时间：2026-02-06  
范围：Gateway + User（单测阶段发现）

## 记录规范
- `风险ID`：模块前缀 + 递增编号，例如 `AUTH-001`。
- `状态`：`Open` / `Accepted` / `Fixed`。
- `处置策略`：仅记账、不改代码，或安排修复。

## 风险清单

| 风险ID | 模块 | 现实现行为 | 预期行为 | 影响 | 严重级别 | 状态 |
| --- | --- | --- | --- | --- | --- | --- |
| AUTH-001 | Gateway Auth Service | `Logout` / `ResetPassword` 成功时返回 `nil response` | 成功时返回空响应对象（非 `nil`）或统一约定 `nil` 并显式文档化 | 调用方若误判为非空对象，存在空指针/契约不一致风险 | 中 | Open |
| BLACKLIST-001 | Gateway Blacklist Handler | `GetBlacklistList` 先 `ShouldBindQuery` 且参数有 `min=1` 校验，`page/pageSize` 缺失时直接参数错误，默认值回填分支不可达 | 缺省分页参数时自动回填 `page=1`、`pageSize=20` | 接口行为与“默认分页”设计不一致，调用方体验不稳定 | 中 | Open |

## 风险详情

### AUTH-001
- 证据代码：
  - `apps/gateway/internal/service/auth_service.go:196`
  - `apps/gateway/internal/service/auth_service.go:226`
  - `apps/gateway/internal/dto/auth_dto.go:306`
  - `apps/gateway/internal/dto/auth_dto.go:314`
- 当前结论：
  - 本轮单测已按现实现行为断言（成功时 `response == nil`）。
  - Handler 层对外仍可正常返回成功响应，但 service 层契约可读性偏弱。
- 处置建议：
  - 二选一并固定到文档：
  - 方案 A：service 成功统一返回空对象（推荐）。
  - 方案 B：明确约定该类方法成功可返回 `nil`，并在接口注释中声明。

### BLACKLIST-001
- 证据代码：
  - `apps/gateway/internal/router/v1/blacklist_handle.go:115`
  - `apps/gateway/internal/router/v1/blacklist_handle.go:120`
  - `apps/gateway/internal/router/v1/blacklist_handle.go:123`
  - `apps/gateway/internal/dto/blacklist_dto.go:27`
  - `apps/gateway/internal/dto/blacklist_dto.go:28`
- 当前结论：
  - 当 `page/pageSize` 为空时，会先触发参数校验错误，默认值逻辑无法生效。
  - 本轮单测已按现实现行为断言（缺参返回 `CodeParamError`）。
- 处置建议：
  - 若产品希望“缺省即默认分页”，需调整绑定/校验顺序或 DTO 校验策略。

## 跟踪约定
- 新增风险时在表格追加，并补充“风险详情”。
- 风险修复后将状态改为 `Fixed`，并补充修复 PR 或提交信息。
