# P0 连接生命周期状态机

**中文说明：** 展示 Connect 连接生命周期状态：连接、鉴权、在线、心跳活跃、断连与重连。

## 过程讲解

1. 初始状态：从 `[ * ]` 进入系统初始态，表示对象刚创建或刚建立连接时的默认状态。
2. 迁移条件：每条箭头代表一次状态迁移，触发条件通常是事件输入、超时、校验结果或业务操作。
3. 收敛与回环：终态表示流程结束；回环表示系统会在运行期持续重复该状态转换。

```mermaid
stateDiagram-v2
    [*] --> Connecting
    Connecting --> Authenticated: token/device validated
    Connecting --> Closed: auth failed
    Authenticated --> Online: register connection
    Online --> HeartbeatActive: heartbeat received
    HeartbeatActive --> Online: continue traffic
    Online --> Disconnected: tcp/ws break
    HeartbeatActive --> Disconnected: timeout/no pong
    Disconnected --> Reconnecting: client retry
    Reconnecting --> Connecting
    Disconnected --> Closed: give up
    Closed --> [*]
```

