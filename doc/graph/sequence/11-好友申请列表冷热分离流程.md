# P1 好友申请列表冷热分离流程

**中文说明：** 展示好友申请列表冷热分离：待处理优先走 Redis，未命中回源 DB，并异步重建缓存。

## 过程讲解

1. 入口阶段：请求先进入图中的入口组件（客户端、Gateway 或 Connect），完成基础参数与上下文准备。
2. 核心处理：中间组件按时序执行鉴权、校验、路由、批处理或状态更新，关键分支在图中用 `alt/loop` 标注。
3. 结果输出：最终将数据写入目标存储或返回调用方；异常场景通常走降级、重试或丢弃保护逻辑。

```mermaid
sequenceDiagram
    participant C as Client
    participant G as Gateway
    participant F as User.FriendService
    participant A as ApplyRepo
    participant R as RedisZSet
    participant D as MySQL

    C->>G: GET /friend/apply-list
    G->>F: GetFriendApplyList(status,page)
    F->>A: GetPendingList
    alt status=0 and Redis hit
        A->>R: ZCARD + ZREVRANGE
    else miss/fallback
        A->>D: query pending list
        A->>R: async rebuild cache
    end
    F->>A: MarkAsReadAsync(ids)
    F->>A: ClearUnreadCount
    F-->>G: list + pagination
    G-->>C: response
```

